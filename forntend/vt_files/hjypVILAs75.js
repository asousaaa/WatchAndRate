/*!CK:3548115900!*//*1449176262,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["+S8i3"]); }

__d('AbstractCommentLiveTypingPublisher',['ActorURI','XUFITypingIndicatorController','destroyOnUnload'],function a(b,c,d,e,f,g,h,i,j){'use strict';if(c.__markCompiled)c.__markCompiled();var k=10*1000,l=10*1000,m=200;function n(p,q,r){this.$PublishURIBuilder1=p;this.$PublishURIBuilder2=q;this.$PublishURIBuilder3=r;}n.prototype.$PublishURIBuilder4=function(){var p=i.getURIBuilder().setString('feedback_id',''+this.$PublishURIBuilder1);if(this.$PublishURIBuilder2)p.setString('parent_comment_id',''+this.$PublishURIBuilder2);return p;};n.prototype.$PublishURIBuilder5=function(p){var q=p.getURI();if(this.$PublishURIBuilder3)q=h.create(q,this.$PublishURIBuilder3);return q;};n.prototype.buildStartURI=function(){return this.$PublishURIBuilder5(this.$PublishURIBuilder4().setEnum('update','start'));};n.prototype.buildStopURI=function(){return this.$PublishURIBuilder5(this.$PublishURIBuilder4().setEnum('update','stop'));};function o(p,q,r){this.$AbstractCommentLiveTypingPublisher1=new n(p,q,r);this.$AbstractCommentLiveTypingPublisher2=null;this.$AbstractCommentLiveTypingPublisher3=null;this.$AbstractCommentLiveTypingPublisher4=-1;j(this.destroy.bind(this));if(window.addEventListener)window.addEventListener('unload',(function(){this.destroy();}).bind(this));}o.prototype.destroy=function(){this.$AbstractCommentLiveTypingPublisher5();this.$AbstractCommentLiveTypingPublisher6();this.$AbstractCommentLiveTypingPublisher7();};o.prototype.handleStartEvent=function(){if(!this.$AbstractCommentLiveTypingPublisher8())this.$AbstractCommentLiveTypingPublisher9();this.$AbstractCommentLiveTypingPublisher10();};o.prototype.handleStopEvent=function(){this.$AbstractCommentLiveTypingPublisher5();};o.prototype.getStartURI=function(){return this.$AbstractCommentLiveTypingPublisher1.buildStartURI();};o.prototype.getStopURI=function(){return this.$AbstractCommentLiveTypingPublisher1.buildStopURI();};o.prototype.ajaxPublishStartEvent=function(){throw new Error('ajaxPublishStartEvent should be overridden by subclass');};o.prototype.ajaxPublishStopEvent=function(){throw new Error('ajaxPublishStopEvent should be overridden by subclass');};o.prototype.$AbstractCommentLiveTypingPublisher8=function(){return !!this.$AbstractCommentLiveTypingPublisher2;};o.prototype.$AbstractCommentLiveTypingPublisher6=function(){if(this.$AbstractCommentLiveTypingPublisher3){clearTimeout(this.$AbstractCommentLiveTypingPublisher3);this.$AbstractCommentLiveTypingPublisher3=null;}};o.prototype.$AbstractCommentLiveTypingPublisher7=function(){if(this.$AbstractCommentLiveTypingPublisher2){clearTimeout(this.$AbstractCommentLiveTypingPublisher2);this.$AbstractCommentLiveTypingPublisher2=null;}};o.prototype.$AbstractCommentLiveTypingPublisher10=function(){var p=Date.now(),q=this.$AbstractCommentLiveTypingPublisher4;if(p>q+m){this.$AbstractCommentLiveTypingPublisher4=p;this.$AbstractCommentLiveTypingPublisher6();this.$AbstractCommentLiveTypingPublisher3=setTimeout((function(){this.$AbstractCommentLiveTypingPublisher5();}).bind(this),l);}};o.prototype.$AbstractCommentLiveTypingPublisher5=function(){if(this.$AbstractCommentLiveTypingPublisher8()){this.ajaxPublishStopEvent();this.$AbstractCommentLiveTypingPublisher7();}this.$AbstractCommentLiveTypingPublisher6();};o.prototype.$AbstractCommentLiveTypingPublisher9=function(){this.ajaxPublishStartEvent();this.$AbstractCommentLiveTypingPublisher7();this.$AbstractCommentLiveTypingPublisher2=setTimeout((function(){this.$AbstractCommentLiveTypingPublisher9();}).bind(this),k);};f.exports=o;},null);